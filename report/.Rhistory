geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in AL")
ggplot(aux[aux$state == 'GA',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in GA")
ggplot(aux[aux$state == 'MN',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in MN")
ggplot(aux[aux$state == 'SC',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in SC")
ggplot(aux[aux$state == 'VA',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in VA")
ggplot(aux[aux$state == 'NC',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in NC")
ggplot(aux[aux$state == 'AL',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in AL")
ggplot(aux[aux$state == 'GA',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in GA")
ggplot(aux[aux$state == 'MN',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in MN")
ggplot(aux[aux$state == 'SC',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in SC")
ggplot(aux[aux$state == 'VA',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in VA")
ggplot(aux[aux$state == 'NC',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in NC")
ggplot(aux[aux$state == 'AL',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in AL")
ggplot(aux[aux$state == 'GA',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in GA")
ggplot(aux[aux$state == 'MN',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in MN")
ggplot(aux[aux$state == 'SC',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in SC")
ggplot(aux[aux$state == 'VA',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in VA")
#North Carolina
st_data <- aux[aux$state == 'NC',]
prelaw <- st_data[st_data$year <= 1998,]
transition <- st_data[(st_data$year > 1998) & (st_data$year <= 2000),]
postlaw <- st_data[st_data$year > 2000,]
prelaw_model <- lm(formula=(subprime ~ year), data=prelaw)
summary(prelaw_model)
postlaw_model <- lm(formula=(subprime ~ year), data=postlaw)
summary(postlaw_model)
predicted <- data.frame(st_data$year, predict(prelaw_model, newdata=st_data))
names(predicted) <- c('year', 'subprime')
prelaw_model2 <- lm(formula=(subprime ~ year + total_population + sthpi + mh_income), data=prelaw)
#Virginia
st_data <- aux[aux$state == 'VA',]
prelaw <- st_data[st_data$year <= 2006,]
#transition <- st_data[(st_data$year > 1999) & (st_data$year <= 2000),]
#postlaw <- st_data[st_data$year > 2000,]
prelaw_model <- lm(formula=(subprime ~ year), data=prelaw)
summary(prelaw_model)
postlaw_model <- lm(formula=(subprime ~ year), data=postlaw)
summary(postlaw_model)
predicted <- data.frame(st_data$year, predict(prelaw_model, newdata=st_data))
names(predicted) <- c('year', 'subprime')
prelaw_model2 <- lm(formula=(subprime ~ year + population + sthpi + mh_income), data=prelaw)
summary(prelaw_model2)
predicted2 <- data.frame(st_data$year, predict(prelaw_model2, newdata=st_data))
names(predicted2) <- c('year', 'subprime')
predicted2_pre <- predicted2[predicted2$year <= 2006,]
predicted2_pos <- predicted2[predicted2$year >= 2006,]
differences <- postlaw[, c('year', 'subprime')]
differences$subprime_predicted <- predicted2[predicted2$year >= 2006,]$subprime
differences$difference <- differences$subprime - differences$subprime_predicted
ggplot(NULL, aes(x=year, y=subprime)) + geom_point(data=prelaw, color='darkgreen') +
#geom_point(data=transition, color='gold') +
#geom_point(data=postlaw, color='darkblue') +
geom_smooth(data=prelaw, method=lm, se=FALSE, color='darkgray', fullrange=TRUE, linetype='dashed') +
geom_line(data=predicted2_pre, color='darkgreen', linetype='dashed') +
#geom_line(data=predicted2_pos, color='blue', linetype='dashed') +
#geom_text(data=prelaw, x=1995, y=150000, label=lm_eqn(prelaw_model), parse=TRUE) +
#geom_segment(data=differences,
#aes(x=year, xend=year, y=subprime, yend=subprime_predicted)) +
theme_minimal() + ggtitle('Virginia')
knitr::opts_chunk$set(echo = TRUE)
library(arm); library(pROC); library(e1071); library(caret); library(knitr)
library(rms); library(ggplot2); library(lme4); library(rstan); library(brms)
library(sjPlot); library(dplyr); library(kableExtra); library(formatR); library(ggfortify)
library(quantreg); library(gridExtra); library(Hmisc); library(corrplot); library(GGally)
library(psych); library(car); library(huxtable); library(stargazer); library(DataExplorer)
library(GGally); library(MASS); library(data.table); library(tidyverse); library(lmerTest)
library(ggpubr); library(reshape2); library(mice); library(naniar); library(cobalt)
library(MatchIt); library(randomForest); library(MuMIn)
lm_eqn <- function(model){
m <- model;
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits=2),
b = format(unname(coef(m)[2]), digits=2),
r2 = format(summary(m)$r.squared, digits=3)))
as.character(as.expression(eq));
}
state_data <- read.csv('../data/final/state_data.csv')
state_relative <- read.csv('../data/final/state_relative.csv')
county_data <- read.csv('../data/final/county_data.csv')
county_relative <- read.csv('../data/final/county_relative.csv')
aux <- state_data[, c(2, 3, 22, 23, 24, 25, 26, 28, 29, 31, 32, 33, 34)]
aux$subprime_perc <- state_relative$subprime
aux$subprime_originated_perc <- state_relative$subprime_originated
ggplot(aux[aux$state == 'NC',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in NC")
ggplot(aux[aux$state == 'AL',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in AL")
ggplot(aux[aux$state == 'GA',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in GA")
ggplot(aux[aux$state == 'MN',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in MN")
ggplot(aux[aux$state == 'SC',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in SC")
ggplot(aux[aux$state == 'VA',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in VA")
ggplot(aux[aux$state == 'NC',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in NC")
ggplot(aux[aux$state == 'AL',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in AL")
ggplot(aux[aux$state == 'GA',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in GA")
ggplot(aux[aux$state == 'MN',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in MN")
ggplot(aux[aux$state == 'SC',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in SC")
ggplot(aux[aux$state == 'VA',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in VA")
ggplot(aux[aux$state == 'NC',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in NC")
ggplot(aux[aux$state == 'AL',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in AL")
ggplot(aux[aux$state == 'GA',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in GA")
ggplot(aux[aux$state == 'MN',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in MN")
ggplot(aux[aux$state == 'SC',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in SC")
ggplot(aux[aux$state == 'VA',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in VA")
#North Carolina
st_data <- aux[aux$state == 'NC',]
prelaw <- st_data[st_data$year <= 1998,]
transition <- st_data[(st_data$year > 1998) & (st_data$year <= 2000),]
postlaw <- st_data[st_data$year > 2000,]
prelaw_model <- lm(formula=(subprime ~ year), data=prelaw)
summary(prelaw_model)
postlaw_model <- lm(formula=(subprime ~ year), data=postlaw)
summary(postlaw_model)
predicted <- data.frame(st_data$year, predict(prelaw_model, newdata=st_data))
names(predicted) <- c('year', 'subprime')
prelaw_model2 <- lm(formula=(subprime ~ year + population + sthpi + mh_income), data=prelaw)
summary(prelaw_model2)
predicted2 <- data.frame(st_data$year, predict(prelaw_model2, newdata=st_data))
names(predicted2) <- c('year', 'subprime')
predicted2_pre <- predicted2[predicted2$year <= 1998,]
predicted2_pos <- predicted2[predicted2$year >= 1998,]
differences <- postlaw[, c('year', 'subprime')]
differences$subprime_predicted <- predicted2[predicted2$year > 2000,]$subprime
differences$difference <- differences$subprime - differences$subprime_predicted
ggplot(NULL, aes(x=year, y=subprime)) + geom_point(data=prelaw, color='darkgreen') +
geom_point(data=transition, color='gold') +
geom_point(data=postlaw, color='darkblue') +
geom_smooth(data=prelaw, method=lm, se=FALSE, color='darkgray', fullrange=TRUE, linetype='dashed') +
geom_line(data=predicted2_pre, color='darkgreen', linetype='dashed') +
geom_line(data=predicted2_pos, color='blue', linetype='dashed') +
#geom_text(data=prelaw, x=1995, y=150000, label=lm_eqn(prelaw_model), parse=TRUE) +
geom_segment(data=differences,
aes(x=year, xend=year, y=subprime, yend=subprime_predicted)) +
theme_minimal() + ggtitle('North Carolina')
state_model <- lm(formula=(subprime_amount_originated ~ as.factor(year) + as.factor(state_code) + did + population + sthpi + mh_income), data=state_data)
knitr::opts_chunk$set(echo = TRUE)
library(arm); library(pROC); library(e1071); library(caret); library(knitr)
library(rms); library(ggplot2); library(lme4); library(rstan); library(brms)
library(sjPlot); library(dplyr); library(kableExtra); library(formatR); library(ggfortify)
library(quantreg); library(gridExtra); library(Hmisc); library(corrplot); library(GGally)
library(psych); library(car); library(huxtable); library(stargazer); library(DataExplorer)
library(GGally); library(MASS); library(data.table); library(tidyverse); library(lmerTest)
library(ggpubr); library(reshape2); library(mice); library(naniar); library(cobalt)
library(MatchIt); library(randomForest); library(MuMIn)
lm_eqn <- function(model){
m <- model;
eq <- substitute(italic(y) == a + b %.% italic(x)*","~~italic(r)^2~"="~r2,
list(a = format(unname(coef(m)[1]), digits=2),
b = format(unname(coef(m)[2]), digits=2),
r2 = format(summary(m)$r.squared, digits=3)))
as.character(as.expression(eq));
}
state_data <- read.csv('../data/final/state_data.csv')
state_relative <- read.csv('../data/final/state_relative.csv')
county_data <- read.csv('../data/final/county_data.csv')
county_relative <- read.csv('../data/final/county_relative.csv')
aux <- state_data[, c(2, 3, 22, 23, 24, 25, 26, 28, 29, 31, 32, 33, 34)]
aux$subprime_perc <- state_relative$subprime
aux$subprime_originated_perc <- state_relative$subprime_originated
ggplot(aux[aux$state == 'NC',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in NC")
ggplot(aux[aux$state == 'AL',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in AL")
ggplot(aux[aux$state == 'GA',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in GA")
ggplot(aux[aux$state == 'MN',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in MN")
ggplot(aux[aux$state == 'SC',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in SC")
ggplot(aux[aux$state == 'VA',], aes(x=population, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Total population in VA")
ggplot(aux[aux$state == 'NC',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in NC")
ggplot(aux[aux$state == 'AL',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in AL")
ggplot(aux[aux$state == 'GA',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in GA")
ggplot(aux[aux$state == 'MN',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in MN")
ggplot(aux[aux$state == 'SC',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in SC")
ggplot(aux[aux$state == 'VA',], aes(x=sthpi, y=subprime)) +
geom_point(alpha=0.5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs STHPI in VA")
ggplot(aux[aux$state == 'NC',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in NC")
ggplot(aux[aux$state == 'AL',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in AL")
ggplot(aux[aux$state == 'GA',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in GA")
ggplot(aux[aux$state == 'MN',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in MN")
ggplot(aux[aux$state == 'SC',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in SC")
ggplot(aux[aux$state == 'VA',], aes(x=mh_income, y=subprime)) +
geom_point(alpha = .5,colour="blue4") +
geom_smooth(method="lm",col="red3") +
labs(title="Subprime applications vs Median Household Income in VA")
#North Carolina
st_data <- aux[aux$state == 'NC',]
prelaw <- st_data[st_data$year <= 1998,]
transition <- st_data[(st_data$year > 1998) & (st_data$year <= 2000),]
postlaw <- st_data[st_data$year > 2000,]
prelaw_model <- lm(formula=(subprime ~ year), data=prelaw)
summary(prelaw_model)
postlaw_model <- lm(formula=(subprime ~ year), data=postlaw)
summary(postlaw_model)
predicted <- data.frame(st_data$year, predict(prelaw_model, newdata=st_data))
names(predicted) <- c('year', 'subprime')
prelaw_model2 <- lm(formula=(subprime ~ year + population + sthpi + mh_income), data=prelaw)
summary(prelaw_model2)
predicted2 <- data.frame(st_data$year, predict(prelaw_model2, newdata=st_data))
names(predicted2) <- c('year', 'subprime')
predicted2_pre <- predicted2[predicted2$year <= 1998,]
predicted2_pos <- predicted2[predicted2$year >= 1998,]
differences <- postlaw[, c('year', 'subprime')]
differences$subprime_predicted <- predicted2[predicted2$year > 2000,]$subprime
differences$difference <- differences$subprime - differences$subprime_predicted
ggplot(NULL, aes(x=year, y=subprime)) + geom_point(data=prelaw, color='darkgreen') +
geom_point(data=transition, color='gold') +
geom_point(data=postlaw, color='darkblue') +
geom_smooth(data=prelaw, method=lm, se=FALSE, color='darkgray', fullrange=TRUE, linetype='dashed') +
geom_line(data=predicted2_pre, color='darkgreen', linetype='dashed') +
geom_line(data=predicted2_pos, color='blue', linetype='dashed') +
#geom_text(data=prelaw, x=1995, y=150000, label=lm_eqn(prelaw_model), parse=TRUE) +
geom_segment(data=differences,
aes(x=year, xend=year, y=subprime, yend=subprime_predicted)) +
theme_minimal() + ggtitle('North Carolina')
#Alabama
st_data <- aux[aux$state == 'AL',]
prelaw <- st_data[st_data$year <= 2006,]
#transition <- st_data[(st_data$year > 1998) & (st_data$year <= 2000),]
#postlaw <- st_data[st_data$year > 2000,]
prelaw_model <- lm(formula=(subprime ~ year), data=prelaw)
summary(prelaw_model)
postlaw_model <- lm(formula=(subprime ~ year), data=postlaw)
summary(postlaw_model)
predicted <- data.frame(st_data$year, predict(prelaw_model, newdata=st_data))
names(predicted) <- c('year', 'subprime')
prelaw_model2 <- lm(formula=(subprime ~ year + population + sthpi + mh_income), data=prelaw)
summary(prelaw_model2)
predicted2 <- data.frame(st_data$year, predict(prelaw_model2, newdata=st_data))
names(predicted2) <- c('year', 'subprime')
predicted2_pre <- predicted2[predicted2$year <= 2006,]
predicted2_pos <- predicted2[predicted2$year >= 2006,]
differences <- postlaw[, c('year', 'subprime')]
differences$subprime_predicted <- predicted2[predicted2$year >= 2006,]$subprime
differences$difference <- differences$subprime - differences$subprime_predicted
ggplot(NULL, aes(x=year, y=subprime)) + geom_point(data=prelaw, color='darkgreen') +
#geom_point(data=transition, color='gold') +
#geom_point(data=postlaw, color='darkblue') +
geom_smooth(data=prelaw, method=lm, se=FALSE, color='darkgray', fullrange=TRUE, linetype='dashed') +
geom_line(data=predicted2_pre, color='darkgreen', linetype='dashed') +
#geom_line(data=predicted2_pos, color='blue', linetype='dashed') +
#geom_text(data=prelaw, x=1995, y=150000, label=lm_eqn(prelaw_model), parse=TRUE) +
#geom_segment(data=differences,
#aes(x=year, xend=year, y=subprime, yend=subprime_predicted)) +
theme_minimal() + ggtitle('Alabama')
#Georgia
st_data <- aux[aux$state == 'GA',]
prelaw <- st_data[st_data$year <= 2001,]
transition <- st_data[(st_data$year > 2001) & (st_data$year <= 2002),]
postlaw <- st_data[st_data$year > 2002,]
prelaw_model <- lm(formula=(subprime ~ year), data=prelaw)
summary(prelaw_model)
postlaw_model <- lm(formula=(subprime ~ year), data=postlaw)
summary(postlaw_model)
predicted <- data.frame(st_data$year, predict(prelaw_model, newdata=st_data))
names(predicted) <- c('year', 'subprime')
prelaw_model2 <- lm(formula=(subprime ~ year + population + sthpi + mh_income), data=prelaw)
summary(prelaw_model2)
predicted2 <- data.frame(st_data$year, predict(prelaw_model2, newdata=st_data))
names(predicted2) <- c('year', 'subprime')
predicted2_pre <- predicted2[predicted2$year <= 2001,]
predicted2_pos <- predicted2[predicted2$year >= 2001,]
differences <- postlaw[, c('year', 'subprime')]
differences$subprime_predicted <- predicted2[predicted2$year > 2002,]$subprime
differences$difference <- differences$subprime - differences$subprime_predicted
ggplot(NULL, aes(x=year, y=subprime)) + geom_point(data=prelaw, color='darkgreen') +
geom_point(data=transition, color='gold') +
geom_point(data=postlaw, color='darkblue') +
geom_smooth(data=prelaw, method=lm, se=FALSE, color='darkgray', fullrange=TRUE, linetype='dashed') +
geom_line(data=predicted2_pre, color='darkgreen', linetype='dashed') +
geom_line(data=predicted2_pos, color='blue', linetype='dashed') +
#geom_text(data=prelaw, x=1995, y=150000, label=lm_eqn(prelaw_model), parse=TRUE) +
geom_segment(data=differences,
aes(x=year, xend=year, y=subprime, yend=subprime_predicted)) +
theme_minimal() + ggtitle('Georgia')
#Minnesota
st_data <- aux[aux$state == 'MN',]
prelaw <- st_data[st_data$year <= 2003,]
transition <- st_data[(st_data$year > 2003) & (st_data$year <= 2004),]
postlaw <- st_data[st_data$year > 2004,]
prelaw_model <- lm(formula=(subprime ~ year), data=prelaw)
summary(prelaw_model)
postlaw_model <- lm(formula=(subprime ~ year), data=postlaw)
summary(postlaw_model)
predicted <- data.frame(st_data$year, predict(prelaw_model, newdata=st_data))
names(predicted) <- c('year', 'subprime')
prelaw_model2 <- lm(formula=(subprime ~ year + population + sthpi + mh_income), data=prelaw)
summary(prelaw_model2)
predicted2 <- data.frame(st_data$year, predict(prelaw_model2, newdata=st_data))
names(predicted2) <- c('year', 'subprime')
predicted2_pre <- predicted2[predicted2$year <= 2003,]
predicted2_pos <- predicted2[predicted2$year >= 2003,]
differences <- postlaw[, c('year', 'subprime')]
differences$subprime_predicted <- predicted2[predicted2$year > 2004,]$subprime
differences$difference <- differences$subprime - differences$subprime_predicted
ggplot(NULL, aes(x=year, y=subprime)) + geom_point(data=prelaw, color='darkgreen') +
geom_point(data=transition, color='gold') +
geom_point(data=postlaw, color='darkblue') +
geom_smooth(data=prelaw, method=lm, se=FALSE, color='darkgray', fullrange=TRUE, linetype='dashed') +
geom_line(data=predicted2_pre, color='darkgreen', linetype='dashed') +
geom_line(data=predicted2_pos, color='blue', linetype='dashed') +
#geom_text(data=prelaw, x=1995, y=150000, label=lm_eqn(prelaw_model), parse=TRUE) +
geom_segment(data=differences,
aes(x=year, xend=year, y=subprime, yend=subprime_predicted)) +
theme_minimal() + ggtitle('Minnesota')
#South Carolina
st_data <- aux[aux$state == 'SC',]
prelaw <- st_data[st_data$year <= 1999,]
transition <- st_data[(st_data$year > 1999) & (st_data$year <= 2000),]
postlaw <- st_data[st_data$year > 2000,]
prelaw_model <- lm(formula=(subprime ~ year), data=prelaw)
summary(prelaw_model)
postlaw_model <- lm(formula=(subprime ~ year), data=postlaw)
summary(postlaw_model)
predicted <- data.frame(st_data$year, predict(prelaw_model, newdata=st_data))
names(predicted) <- c('year', 'subprime')
prelaw_model2 <- lm(formula=(subprime ~ year + population + sthpi + mh_income), data=prelaw)
summary(prelaw_model2)
predicted2 <- data.frame(st_data$year, predict(prelaw_model2, newdata=st_data))
names(predicted2) <- c('year', 'subprime')
predicted2_pre <- predicted2[predicted2$year <= 1999,]
predicted2_pos <- predicted2[predicted2$year >= 1999,]
differences <- postlaw[, c('year', 'subprime')]
differences$subprime_predicted <- predicted2[predicted2$year > 2000,]$subprime
differences$difference <- differences$subprime - differences$subprime_predicted
ggplot(NULL, aes(x=year, y=subprime)) + geom_point(data=prelaw, color='darkgreen') +
geom_point(data=transition, color='gold') +
geom_point(data=postlaw, color='darkblue') +
geom_smooth(data=prelaw, method=lm, se=FALSE, color='darkgray', fullrange=TRUE, linetype='dashed') +
geom_line(data=predicted2_pre, color='darkgreen', linetype='dashed') +
geom_line(data=predicted2_pos, color='blue', linetype='dashed') +
#geom_text(data=prelaw, x=1995, y=150000, label=lm_eqn(prelaw_model), parse=TRUE) +
geom_segment(data=differences,
aes(x=year, xend=year, y=subprime, yend=subprime_predicted)) +
theme_minimal() + ggtitle('South Carolina')
#Virginia
st_data <- aux[aux$state == 'VA',]
prelaw <- st_data[st_data$year <= 2006,]
#transition <- st_data[(st_data$year > 1999) & (st_data$year <= 2000),]
#postlaw <- st_data[st_data$year > 2000,]
prelaw_model <- lm(formula=(subprime ~ year), data=prelaw)
summary(prelaw_model)
postlaw_model <- lm(formula=(subprime ~ year), data=postlaw)
summary(postlaw_model)
predicted <- data.frame(st_data$year, predict(prelaw_model, newdata=st_data))
names(predicted) <- c('year', 'subprime')
prelaw_model2 <- lm(formula=(subprime ~ year + population + sthpi + mh_income), data=prelaw)
summary(prelaw_model2)
predicted2 <- data.frame(st_data$year, predict(prelaw_model2, newdata=st_data))
names(predicted2) <- c('year', 'subprime')
predicted2_pre <- predicted2[predicted2$year <= 2006,]
predicted2_pos <- predicted2[predicted2$year >= 2006,]
differences <- postlaw[, c('year', 'subprime')]
differences$subprime_predicted <- predicted2[predicted2$year >= 2006,]$subprime
differences$difference <- differences$subprime - differences$subprime_predicted
ggplot(NULL, aes(x=year, y=subprime)) + geom_point(data=prelaw, color='darkgreen') +
#geom_point(data=transition, color='gold') +
#geom_point(data=postlaw, color='darkblue') +
geom_smooth(data=prelaw, method=lm, se=FALSE, color='darkgray', fullrange=TRUE, linetype='dashed') +
geom_line(data=predicted2_pre, color='darkgreen', linetype='dashed') +
#geom_line(data=predicted2_pos, color='blue', linetype='dashed') +
#geom_text(data=prelaw, x=1995, y=150000, label=lm_eqn(prelaw_model), parse=TRUE) +
#geom_segment(data=differences,
#aes(x=year, xend=year, y=subprime, yend=subprime_predicted)) +
theme_minimal() + ggtitle('Virginia')
